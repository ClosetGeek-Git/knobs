<!DOCTYPE HTML>
<html>
<head>
	<title>Knob - Sprites</title>
	<link rel="stylesheet" href="asset/ui.css" />
	<script src="../Knob.js"></script>

</head>
<body>
	<div id="spriteContainer" class="container">
		<canvas id="spriteContent"></canvas>
	</div>
	<div id="spritePositionContainer" class="container">
		<canvas id="spritePositionContent"></canvas>
	</div>
	<div id="spriteRotateContainer" class="container">
		<canvas id="spriteRotateContent"></canvas>
	</div>

	<!-- mouse/touch events -->
	<script src="asset/ui.js"></script>

 	<!-- Custom rendering code -->
	<script type="text/javascript">

	(function() {
		// Canvas width and height should match its parent container
		var canvases = document.getElementsByTagName('canvas');
		for(var i=0; i < canvases.length;i++) {
			canvases[i].width  = canvases[i].parentElement.clientWidth;
			canvases[i].height = canvases[i].parentElement.clientHeight;
		}
	})();

	var drawCenteredImage = function(context, image) {
		if(context && image) {
			context.drawImage(image, -image.width/2, -image.height/2, image.width, image.height);
		}
	}

	function drawIndicatorImage(image) {
		return function(c, k, i) { drawCenteredImage(c, image); }
	}

	var drawIndicator = function(context, knob, indicator, drawIndicatorFn) {
		context.save();

		context.translate(indicator.x, indicator.y);
		context.rotate(-indicator.angle*(Math.PI/180));

		if(drawIndicatorFn)
			drawIndicatorFn(context, knob, indicator);

		context.restore();
	};

	var drawKnob = function(context, knob, indicator, drawIndicatorFn, spriteOffset, spriteImage) {

		var spriteX = Math.floor(context.canvas.width/2  - knob.options.spriteWidth/2),
			spriteY = Math.floor(context.canvas.height/2 - knob.options.spriteHeight/2);

		context.clearRect(0, 0, context.canvas.width, context.canvas.height);

		context.drawImage(spriteImage,
						  spriteOffset.x, spriteOffset.y, knob.options.spriteWidth, knob.options.spriteHeight,
								 spriteX,        spriteY, knob.options.spriteWidth, knob.options.spriteHeight);

		drawIndicator(context, knob, indicator, drawIndicatorFn)
	}

	var loadImage = function(callback, path) {
		var image = new Image();
		image.onload = function() {
			if(callback) { callback.call(this); }
		}
		image.src = path;
		return image;
	}

	var createSpriteKnob = function(options, canvas, spriteImagePath, indicatorImagePath) {

		var context = canvas.getContext('2d'),
			container = canvas.parentElement,
			spriteImage, indicatorImage,
			knob = new Knob(function(knob, angle, val, indicator, spriteOffset) {

				drawKnob(context, knob, indicator, drawIndicatorImage(indicatorImage), spriteOffset, spriteImage);

			}, options);

		if(typeof indicatorImagePath !== "undefined") {
			indicatorImage = loadImage(function() {
				spriteImage = loadImage(function() {
					setupKnob(knob, container);
				}, spriteImagePath);
			}, indicatorImagePath);
		}
		else {
			spriteImage = loadImage(function() {
				setupKnob(knob, container);
			}, spriteImagePath);
		}
	}


	/**
	 * Pre-rendered knob using sprites.
	 */
	var options = {
		spriteCount: 120,
		spriteSeparationGap: 1,
		spriteWidth: 67,
		spriteHeight: 67,
		spriteDirection: 'ccw'
	}
	createSpriteKnob(options,
					document.getElementById("spriteContent"),
					"asset/garageband/33gc_thumb_27.png");


	/**
	 * Knob with repeating sprites and a positioned indicator image.
	 */
	var options = {
		// angleSlideRatio: 0.6,
		spriteCount: 5,
		spriteSeparationGap: 1,
		spriteWidth: 100,
		spriteHeight: 100,
		spriteDirection: 'cw',
		indicatorRadius: 26,
		indicatorAutoPosition: true
	}
	createSpriteKnob(options,
					document.getElementById("spritePositionContent"),
					"asset/garageband/Hammond_knob.png",
					"asset/garageband/hammond_overdrive_dot.png");


	/**
	 * Knob with repeating sprites and a rotating indicator image.
	 */
	var options = {
		// angleSlideRatio: 0.8,
		spriteStartAngle: 90,
		spriteCount: 17,
		spriteSeparationGap: 1,
		spriteWidth: 93,
		spriteHeight: 93,
		spriteDirection: 'cw',
		indicatorStartAngle: 90,
		indicatorAutoRotate: true
	}
	createSpriteKnob(options,
					document.getElementById("spriteRotateContent"),
					"asset/garageband/40synth.png",
					"asset/garageband/39Synth_Thumb.png");

	</script>
</body>
</html>
